package net.satcy.net {	import flash.events.*;	import flash.display.Loader;	import flash.net.URLLoader;	import flash.net.URLRequest;	import flash.system.*;	/**	*	@author satcy@satcy.net		*		*	@since 22.11.2007	*		*	現在のYoutubeのクロスドメインの関係で、	 * これだけでは、ネットワーク上では機能しません.		*	現在のYoutubeのクロスドメイン	*	異なるドメイン間の場合crossdomain.xml画筆用	*	<?xml version="1.0"?>		<!-- http://www.youtube.com/crossdomain.xml -->		<cross-domain-policy>	  		<allow-access-from domain="*.youtube.com" />	  		<allow-access-from domain="*.google.com" />		</cross-domain-policy>				YouTube覚え書き				そもそも		http://cache.googlevideo.com/get_video?video_id=		が通用しなくなってた。				http://cache.googlevideo.com/get_video?video_id=***&origin=youtube.com		originでサーバーをしていしないとダメ。				そこで、HTMLを読み込んで、それを解析してみたのだが、ローカルではうまく行くが、		crossdomainもyoutube.com,google.comだけになったので、flashから、URLLoaderでHTMLページ読み込んで、抜き出すとかも出来ない。		そもそも、crossdomainがないと、URLLoaderは機能しない仕様				結局、cgi等で、ビデオのページ内からv＝とt=を引っこ抜いて、http://cache.googlevideo.com/get_video?video_id=***&t=***		としないとダメっぽい。								おまけ：		外部のFLVを、draw()する方法		video.attachNetStream(null);//nullにして、、、		bmd.draw(video); // ビットマップデータを取得		video.attachNetStream(stream);//もどす	*/	public class YouTubeSpy {				public var path:String;				private var onCompleteFunc:Function;				public function YouTubeSpy(str:String, fn:Function = null){			var loaderContext:LoaderContext = new LoaderContext ();			loaderContext.checkPolicyFile = true;			Security.allowDomain("youtube.com");			var myLoader:URLLoader = new URLLoader();			//var myLoader:Loader = new Loader();			myLoader.addEventListener(Event.COMPLETE, completeData);			myLoader.load(new URLRequest(str));			onCompleteFunc = fn;		}				private function completeData(event:Event):void {			var myLoader = event.target;			myLoader.removeEventListener(Event.COMPLETE, completeData);						parseHTML( myLoader.data);			if(onCompleteFunc != null) onCompleteFunc(path);			path = null;			onCompleteFunc = null;			delete this;		}		private function parseHTML( _str ){			////		    var targetLine:String = _str.substring(_str.indexOf("var fullscreenUrl"), _str.indexOf("var watchGamUrl") ); 		    var vID:String = targetLine.substring( targetLine.indexOf("video_id=")+9, targetLine.indexOf("&t="));		    var after_t=targetLine.substring( targetLine.indexOf("&t=")+3);		    var t;		    if( after_t.indexOf("&")!=-1 ){		        t=after_t.substring( 0, after_t.indexOf("&"));		    }else{		        t=after_t;		    }		   	path="http://youtube.com/get_video.php?video_id="+vID+"&l&t="+t; 			//trace("youtube _video_path::::::"+path);		}	}	}